#!/usr/bin/env ruby
require 'bundler/setup'
require 'redstruct/all'

Bundler.require(:default, :development)

# Prepare connection configuration
Redstruct.config.namespace = 'redstruct'.freeze
Redstruct.config.connection_pool = ConnectionPool.new(size: 2, timeout: 5) do
  Redis.new(host: ENV.fetch('REDIS_HOST', '127.0.0.1'), port: ENV.fetch('REDIS_PORT', 6379).to_i)
end

def reload!
  verbosity = $VERBOSE
  begin
    $VERBOSE = nil
    files = $LOADED_FEATURES.select { |feat| feat =~ %r{/redstruct/} }
    files.each { |file| load(file) }
  ensure
    $VERBOSE = verbosity
  end

  return nil
end

Pry.start
